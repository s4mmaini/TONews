<!doctype html>
<html lang="en" class="%sveltekit.theme%">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="theme-color" content="#ffffff" id="theme-color" />
    <title>TONews</title>

    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <link rel="manifest" href="%sveltekit.assets%/manifest.json" />
    <link
      rel="icon"
      type="image/svg+xml"
      href="%sveltekit.assets%/svg/kagi_news_icon.svg"
    />
    <link
      rel="apple-touch-icon"
      href="%sveltekit.assets%/apple-touch-icon.png"
    />

    <!-- Prevent flash of wrong theme - minimal script that only handles dark mode detection -->
    <script>
      (function () {
        try {
          // Check if we're in a browser environment
          if (typeof window === "undefined") return;

          // Try to get theme from localStorage with error handling
          let storedTheme = null;
          try {
            storedTheme = localStorage.getItem("theme");
          } catch (storageError) {
            // localStorage might be blocked in private mode or by security settings
            console.warn("localStorage not accessible:", storageError);
          }

          let darkModePreferred = false;

          if (storedTheme === "dark") {
            darkModePreferred = true;
          } else if (storedTheme === "system" || !storedTheme) {
            // Check system preference for 'system' theme or when no theme is stored
            const darkMediaQuery = window.matchMedia(
              "(prefers-color-scheme: dark)",
            );
            darkModePreferred = darkMediaQuery.matches;
          }
          // If storedTheme === 'light', darkModePreferred remains false

          // Apply dark mode class if needed
          if (darkModePreferred) {
            document.documentElement.classList.add("dark");
          }

          // Update theme-color meta tag immediately
          const themeColorMeta = document.getElementById("theme-color");
          if (themeColorMeta) {
            const newColor = darkModePreferred ? "#1f2937" : "#ffffff";
            themeColorMeta.setAttribute("content", newColor);
          }

          // Update favicon for dark mode
          const favicon = document.querySelector('link[rel="icon"]');
          if (favicon) {
            favicon.href = darkModePreferred
              ? "/svg/kagi_news_icon_dark.svg"
              : "/svg/kagi_news_icon.svg";
          }
        } catch (e) {
          console.error("Theme detection error:", e);
        }
      })();
    </script>

    %sveltekit.head%
  </head>
  <body
    data-sveltekit-preload-data="hover"
    class="dark:bg-dark-bg dark:text-dark-text min-h-screen bg-white text-black"
  >
    <div style="display: contents">%sveltekit.body%</div>
  </body>
</html>
